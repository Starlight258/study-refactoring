# 1. 리팩터링 what why when
## 리팩터링 정의
- 소프트웨어의 **겉보기 동작**은 그대로 유지한 채, 여러 가지 **리팩터링 기법**을 적용해서 소프트웨어를 재구성하다.
> 기능 추가와 리팩터링은 다른 모자이다.

## 리팩터링하는 이유
### 리팩터링하면 소프트웨어 설계가 좋아진다
- 규칙적인 리팩터링은 코드의 설계 구조를 유지하게 해준다.
  - 코드를 수정하다보면 기반 구조가 무너지기 쉽다.
- 같은 일을 하더라도 설계가 나쁘면 코드가 길어진다.
  - 중복 코드 제거를 위해 설계를 개선하자.

### 리팩터링하면 소프트웨어를 이해하기 쉬워진다
- 잘 작동하지만 이상적인 구조가 아닌 코드가 있다면 시간을 내서 리팩토링해보자.
- 한 시간 내에 끝낼 수정을 일주일이나 걸리게 만들지 말자.

### 리팩터링하면 버그를 쉽게 찾을 수 있다.
- 코드를 이해하기 쉽다 = 버그를 잘 찾을 수 있다.
- 프로그램의 구조를 다듬으면 코드가 하는 일을 깊이 파악하게 되면서 버그를 명확하게 파악할 수 있다.

### 리팩터링하면 프로그래밍 속도를 높일 수 있다.
- 코드 개발 속도를 높일 수 있다.
- 내부 설계가 잘 된 소프트웨어는 새로운 기능을 추가할 지점과 어떻게 고칠지를 쉽게 찾을 수 있다.
- 모듈화가 잘 되어있으면 코드베이스 중 작은 일부만 이해하면 된다.
- 코드가 명확하면 버그를 만들 가능성도 줄고, 버그를 만들더라도 디버깅하기 훨씬 쉽다.
> 설계 지구력 가설 : 내부 설계에 심혈을 기울이면 프로그램의 지구력이 높아져서 빠르게 개발할 수 있는 상태를 더 오래 지속할 수 있다.

## 언제 리팩터링해야 할까?
### 3의 법칙
- 1. 처음에는 그냥 한다.
- 2. 비슷한 일을 두번째로 하게 되면 일단 계속 진행한다.
- 3. 비슷한 일을 세 번째 하게 되면 리팩터링한다.
> 스트라이브 세 번이면 리팩터링하라(삼진 리팩터링)

### 준비를 위한 리팩터링 : 기능을 쉽게 추가하게 만들기
- 리팩터링하기 가장 좋은 시점은 코드베이스에 기능을 새로 추가하기 직전이다.
- 현재 코드를 살펴보면서, 구조를 살짝 바꾸면 다른 작업을 하기 쉬워지는 부분을 찾는다.
  - **중복 코드 제거** -> 함수 매개변수화하기(11.2절)
- 준비를 위한 리팩터링으로 상황을 개선하면 같은 곳에서 다른 버그가 발생할 확률을 낮출 수 있다.

### 이해를 위한 리팩터링: 코드를 이해하기 쉽게 만들기
- 코드를 분석할 때 리팩터링을 해 보면, **더 깊은 수준까지 이해하게 된다.**
  - ex) 역할에 맞게 적절한 이름으로 변수 수정하기
  - ex) 긴 함수를 잘게 나누기

### 쓰레기 줍기 리팩터링
- 간단히 수정할 수 있는 것은 **즉시 고치고**, 시간이 좀 걸리는 일은 짧은 메모만 남긴 댜음, **하던 일을 끝내고 나서 처리**한다.
  - 쓰레기가 나뒹굴게 하지 않고 조금이라도 고친 후에, 후에 처리하자.
  - 리팩토링의 장점은 각각의 작은 단계가 코드를 깨뜨리지 않는다는 사실이다.
> 나뒹굴고 있는 쓰레기를 줍고, 후에 조금씩 리팩토링하자.

### 계획된 리팩터링과 수시로 하는 리팩터링
- 리팩터링을 계획하지 말고, 수시로 하자.
> [!NOTE] 리팩토링을 프로그래밍 과정에 자연스럽게 녹이자
> 리팩터링 일정을 따로 잡지 않고, 기능을 추가하거나 버그를 수정할 때 함께 하자.
> **"보기 싫은 코드를 발견하면 리팩터링하자. 그런데 잘 작성된 코드 역시 수많은 리팩터링을 거쳐야 한다."**

- 상황이 변해 기준을 변경해야할 때, 코드가 이미 깔끔하다면 리팩터링하기가 더 쉽다.
  - 무언가 수정하려 할 때는 먼저 수정하기 쉽게 정돈하고 그런 다음 쉽게 수정하자.
- 뛰어난 개발자는 **새 기능을 추가하기 쉽도록 코드를 수정하는 것**이 그 기능을 가장 빠르게 추가하는 길임을 안다.

- 계획된 리팩터링을 하게 되는 일은 최대한 줄여야 한다.
  - **리팩터링 작업 대부분은 드러나지 않게, 기회가 될 때마다 해야한다.**
> 리팩터링을 체화하자!

### 오래 걸리는 리팩터링
- 리팩터링은 짧은 시간동안 수행될 수도 있지만, 팀 전체가 몇 주간 걸리는 대규모 리팩터링도 있다.
  - ex) 라이브러리를 새 것으로 교체, 일부 코드를 다른 팀과 공유하기 위해 컴포넌트로 빼내는 작업
- 팀 전체가 몇주간 리팩터링에 매달리는 것보다는, **주어진 문제를 몇 주에 거쳐 조금씩 해결해가는 편**이 효과적일 때가 많다.
  - 누구든지 리팩터링해야할 코드와 관련한 작업을 할 때마다 **원하는 방향으로 조금씩 개선**하는 식이다.
> 리팩터링은 코드를 깨뜨리지 않는다! 라는 장점을 활용하자.

- 라이브러리를 교체할 때는, 기존 것과 새 것 모두를 포용하는 **추상 인터페이스**부터 마련한다.
  - 기존 코드가 이 추상 인터페이스를 호출하도록 만들고 나면 라이브러리를 훨씬 쉽게 교체할 수 있다. (추상화로 갈아타기 전략)

### 코드 리뷰에 리팩터링 활용하기
- 코드 리뷰는 개발팀 전체에 지식을 전파하는데 좋다.
  - 다른 사람의 아이디어를 얻고, 제시한 아이디어가 실제로 코드로 반영되는 모습을 확인할 수 있다.
- 코드 리뷰는 **풀 요청 모델** (코드 작성자 없이 검토하는 방식) 보다는 **참석자가 참여하는 방식** (pair programming)이 좋다.
  - 작성자와 함께 앉아 나란히 코드의 맥락과 변경 의도를 설명받고 이야기하는 방식이 제일 좋다.

### 관리자에게 뭐라고 말해야 할까?
- 관리자가 기술에 정통하고 설계 지구력 가설도 잘 이해하고 있다면, 리팩터링의 필요성을 쉽게 설득할 수 있다.
  - 이런 관리자는 오히려 정기적인 리팩터링을 권장할 뿐만 아니라 팀이 리팩터링을 충분히 하고 있는지 살펴본다.
- 기술을 모르는 상당수의 관리자와 고객은 코드베이스의 건강 상태가 생산성에 미치는 영향을 모른다.
  - 이런 상황에 있는 이들에게는 리팩터링한다고 말하지 말라고 조언하겠다.
- 프로 소프트웨어 개발자는 효과적인 소프트웨어를 최대한 빨리 만든다.
  - 리팩터링하고 함수를 추가하고, 버그를 수정하는 것이 가장 빠르다.
  - **가장 빠른 방법이 리팩터링이기 때문에, 리팩터링부터 한다.**

### 리팩터링하지 말아야 할 때
- 리팩터링하면 안되는 상황도 있다.
- 1. 지저분한 코드를 발견해도 **굳이 수정할 필요가 없다면 리팩터링하지 않는다.**
  - 외부 API를 다루듯 호출해서 쓰는 코드라면 지저분해도 그냥 둔다.
  - **내부 동작을 이해해야 할 시점**에 리팩터링해야 효과를 제대로 볼 수 있다.
- 2. **리팩터링하는 것보다 처음부터 새로 작성하는 게 쉬울 때**도 리팩터링하지 않는다.
  - 쉽지 않은 결정이므로, 리팩터링할지 새로 작성할지를 잘 결정하려면 뛰어난 판단력과 경험이 뒷받침돼야 한다.

